# 06 コンフリクトの理解と解決

## 1. この章のゴール
- コンフリクト（衝突）が起きる理由を、怖がらずに説明できる。
- Sourcetree でコンフリクトが起きたときの “見え方” を理解する。
- VS Code を使ってコンフリクトを解決し、コミットして先に進める。

## 2. 概念の説明（図や比喩を使ってわかりやすく）
- **コンフリクト**：同じファイルの同じ場所を、別々の変更が同時に書き換えたときに起きます。
- Git は「どっちを採用すべきか自動で決められない」ので、一旦止まってあなたに選んでもらいます。
- たとえるなら「二人が同じホワイトボードの同じ行を同時に書き換えた状態」です。

怖く見えるだけで、やることはシンプルです：
1) どっちの内容を残すか決める → 2) ファイルを整える → 3) “解決済み” にしてコミットする

## 3. 実際の操作手順（Sourcetree + VS Code）
### 3-1. まず予防：コンフリクトを減らすコツ
- 作業開始前に `develop` をチェックアウト → `Pull` で最新化
- 同じファイルを長時間編集し続けない（区切りでコミット）

### 3-2. コンフリクトが起きたときの “見え方”（Sourcetree）
- `Pull` や `Merge` の途中で止まる
- `Conflicts` の表示が出る
- `File Status` に赤いアイコンのファイルが並ぶ

目印（スクショ不要）：`File Status` を開くと、`Conflicts`（または赤い表示）のファイル一覧が出ます。ここに出ているファイルが「今解決が必要なもの」です。

### 3-3. 解決する（VS Codeで編集）
- Sourcetree の `File Status` で、衝突しているファイルをクリック
- `Resolve Conflicts` / `Open in External Merge Tool`（表示名は環境で異なる）を選ぶ
- VS Code が開いたら、次を確認する
  - `<<<<<<` や `======` のような “コンフリクトマーカー” が見える
  - VS Code のマージ画面が出る場合は、`Accept Current` / `Accept Incoming` などのボタンが出る
- `Current` は「いまチェックアウトしているブランチ（あなた側）」、`Incoming` は「取り込み元のブランチ（例：develop側）」です
- 「最終的に残したい文章」になるように整える（両方必要なら両方残して OK）
- 保存する
目印（スクショ不要）：VS Code の衝突箇所の近くに `Accept Current/Incoming`（または `Accept Current Change` など）ボタンが出ることがあります。出ない場合は、マーカー（`<<<<<<` など）を手で消して文章を整えればOKです。

### 3-4. “解決済み” にしてコミットする（Sourcetree）
- Sourcetree に戻る
- そのファイルが “Resolved” になっているか確認（必要なら `Mark Resolved` を押す）
- ステージング → コミット（例：`Resolve conflict in README`）
- 必要なら `Push`

### 3-5. PRで「Conflicts」と出たとき（いちばん多い実戦パターン）
GitHub の PR 画面で `This branch has conflicts` のように表示されたら、だいたい「`develop` 側が進んでいて、あなたの `feature` が古い」状態です。  
やることは **feature に develop を取り込んで（マージして）押し上げる** だけです。

1) `develop` を最新化
- Sourcetree で `develop` をチェックアウト
- `Pull` で最新化

2) `feature` に `develop` をマージ
- `feature/task1`（自分の PR のブランチ）をチェックアウト
- 上部の `Merge` をクリック
- 取り込み元に `develop` を選ぶ → `OK`

3) コンフリクトが出たら解決
- もし `Conflicts` が出たら、この章の `3-3`〜`3-4` の手順で解決 → コミット

4) `feature` をプッシュ
- `Push` して GitHub に反映
- PR 画面を更新して、`Able to merge`（または同等の表示）になればOK
目印（スクショ不要）：GitHub の PR 画面の「マージ」エリアに `This branch has conflicts`（または同等の表示）が出ます。解決して push すると `Able to merge` に戻ります。

## 4. よくあるミス・つまずきポイント
- コンフリクトマーカー（`<<<<<<` など）を残したままコミットしてしまう → コミット前にファイルを必ず開いて確認。
- “どっちか分からないけど消した” で進めてしまう → 不安なら先生に相談して OK。
- そもそも `develop` を最新化していない → まず `develop` で `Pull` の習慣。

## 5. AIに聞いてみよう（質問例）
このページを開いたまま、下のテンプレをコピペして質問すると「どっちを残す？」の判断がしやすくなります。

**コピペ用テンプレ（コンフリクト解決）**
```md
初心者です。いま「06 コンフリクトの理解と解決」を開いています。

どこで起きた：Pull / Merge / PR（GitHubでConflicts表示）
対象ブランチ：develop / feature/___
衝突しているファイル：（例）practice.md
やりたいこと：（例）両方の変更を残して整えたい / Aを残してBを捨てたい
画面の情報：（どの画面で何が表示されているか。スクショは任意）
もし貼れるなら：衝突部分のテキスト（秘密情報なし）
※秘密鍵・トークン・パスワードは貼りません
```

### 5-1. 具体例（このまま質問してOK）
- 「`3-5 PRでConflicts` のパターンです。PRで `This branch has conflicts` と出ました。**CLIなし**で、`feature` に `develop` を取り込むクリック順を教えて（Sourcetreeの画面名つきで）」
- 「VS Code のマージ画面で `Accept Current / Accept Incoming` が出ています。いま私は（feature/developどっち）をチェックアウト中。どれを押すべきか判断の考え方を教えて」
- 「この衝突部分のテキストを貼るので、最終的にどう整えるのが自然？“残す案” を1つ作って（理由も短く）」
- 「解決したつもりなのに Sourcetree の `Conflicts` が消えない。`Mark Resolved` の場所と、次にやること（ステージ→コミット）を確認して」
- 「コンフリクトマーカー（`<<<<<<` など）を消したか不安。コミット前にチェックすべき “3つの確認” を教えて」

## 6. ハンズオン課題（成果物提出を想定）
- 第2章の「模擬課題2（コンフリクト練習）」を実施し、PRでConflictsが出た状態から解決してマージする。
- チーム作業を想定して、同じファイル（例：`README.md`）を別々のブランチで編集してみる。
- コンフリクトが起きたら、VS Code で解決してコミットする。
- PR のコメント欄に「どう解決したか」を1行で説明してみる（例：両方の文章を残して整形しました）。

## 7. チェックリスト（理解確認）
- [ ] コンフリクトが起きる理由を説明できる。
- [ ] Sourcetree でコンフリクトの状態を見分けられる。
- [ ] VS Code で解決してコミットまでできる。
