# 07 トラブルシューティング（詰まったらここ）

## 1. この章のゴール
- 「詰まった…」となったときに、落ち着いて原因を切り分けられる。
- よくある3大トラブル（ブランチ間違い／認証エラー／コンフリクト）を自力で立て直せる。

## 2. まず最初に見る3点セット（1分でできる）
1. **今いるブランチ**：Sourcetree 左のブランチ一覧で太字/チェックのもの
2. **未コミットの変更**：`File Status` が空か？ `Unstaged/Staged` に何か出ているか？
3. **エラー文の全文**：短くしないでそのまま控える（コピーできなければ書き写す）

目印：
- 「今いるブランチ」＝左サイドバー `Branches` の太字/チェック
- 「未コミットの変更」＝上部タブ `File Status` の `Unstaged/Staged` に何か出ているか

## 3. ブランチを間違えて `main` で作業してしまった
まず安心してください。よくあるミスで、ちゃんと戻せます。

### A）まだコミットしていない（変更が作業中）
- Sourcetree で `main` を選ぶ
- 上部の `Branch` をクリック
- ブランチ名を `feature/task1` にする
- `Checkout new branch` にチェック → 作成
- そのまま `File Status` → ステージング → コミット → プッシュ

### B）すでにコミットしてしまった（`main` にコミットが乗った）
安全第一で進めます。

- まず保険：`main` を右クリック → `Branch...` → `backup/main-mistake` のような名前でブランチを作る
- そのコミット地点から `feature/task1` を作って作業を続ける
- `main` を元に戻す（Reset など）は強い操作なので、授業ルールに合わせて先生に確認するのがおすすめです
目印：`main` の行を右クリック → `Branch...` を選ぶと、退避用ブランチ（`backup/...`）が作れます。

## 4. コミットできない（名前/メールが未設定）
よくある表示：`Please tell me who you are.` / `unable to auto-detect email address`

コミットには「誰が書いた変更か（作者）」の情報が入るので、初回だけ名前とメールの設定が必要です。

- Sourcetree → `Preferences` / `Options`
- `Default user information` / `ユーザー情報` を探す
- `Name` と `Email` を入力して保存

※ 詳しい場所は第1章（環境構築）の「3-3.5」を見ればOKです。
目印：`Preferences/Options` の中の `Default user information`（または「ユーザー情報」）に `Name/Email` の入力欄があります。

## 5. プッシュできない（認証エラー）チェックリスト
よくある表示：`Permission denied (publickey)` / `Authentication failed`

### 5-1. まず確認（ここが9割）
- GitHub の `Code` → `SSH` の URL（`git@github.com:...`）を使っている？
- GitHub に **公開鍵（.pub）** を登録した？（`Settings` → `SSH and GPG keys`）
- Sourcetree の設定で **秘密鍵** を指定した？
目印：GitHub 右上の自分アイコン → `Settings` → 左メニューの `SSH and GPG keys` に公開鍵を追加します。

### 5-2. それでもダメなとき
- 別の鍵を作り直した場合、GitHub 側も新しい公開鍵に差し替えた？
- リポジトリのURLが合っている？（課題のリポジトリを間違えていない？）
- 会社/学校ネットワークで SSH が制限されている可能性（その場合は先生に相談）

## 6. プッシュが拒否された（更新が必要）
よくある表示：`rejected` / `non-fast-forward` / 「先にプルしてください」

これは「GitHub 側のほうが新しい」状態です。慌てずに次の順でOKです。

1. **今プッシュしたいブランチ**（例：`feature/task1`）をチェックアウト
2. `Pull`（必要ならコンフリクト解決 → コミット）
3. もう一度 `Push`

※ `main` が保護されていてプッシュできない場合は“正常”です。`feature/...` で作業して PR を出しましょう。

### 6-1. 初回Pushで「upstream（上流ブランチ）」が無いと言われた
よくある表示：`no upstream branch` / 「上流ブランチが設定されていません」など

これは「リモート（GitHub）に、同じ名前のブランチがまだ無い」ことが多いです。やることはシンプルです。

1. いまいるブランチが `feature/...` か確認（`main/develop` ではない）
2. Sourcetree の `Push` を開く
3. 一覧で **`feature/...` にチェック** → `Push`（これで GitHub に同名ブランチが作られます）
4. `Track / Set upstream / 追跡` のようなチェックがあれば ON（無ければそのままでOK）

## 7. PRが作れない／`feature` ブランチがGitHubに見えない
- `feature/task1` を **プッシュしていない** 可能性が高いです
  - Sourcetree で `feature/task1` をチェックアウト → `Push`
- PR の `base` が `develop` になっているか確認
目印：GitHub の `Code` タブで、左上あたりのブランチ切り替え（通常 `main` と表示）を開くとブランチ一覧が見られます。

## 8. コンフリクトが起きた（Sourcetreeでの見え方と考え方）
**コンフリクト**＝同じ場所を別々の変更が書き換えて、Git が自動で決められない状態です。悪いことではありません。

### 8-1. Sourcetreeでの見え方
- `Pull` や `Merge` の途中で止まる
- `Conflicts` の表示が出る
- `File Status` に赤いアイコンのファイルが並ぶ

### 8-2. 解決の考え方（初心者向け）
1. どっちの内容を残すか決める（両方必要なら両方残してOK）
2. VS Code でファイルを整える
3. “解決済み” にしてコミット → 必要ならプッシュ

手順の詳細は第6章「コンフリクトの理解と解決」を見ながら進めてください。

## 9. 相談するときのテンプレ（最短で助けてもらう）
このページを開いたまま AI に質問すると、AI はこの章の内容を見たうえで答えられます。  
下のテンプレをコピペして、空欄を埋めてください。

```md
初心者です。いま「07 トラブルシューティング（詰まったらここ）」を開いています。

目的：（例）feature/task1をdevelopへPR提出したい
今いるブランチ：（Sourcetreeで太字/チェックのブランチ名）
どこで詰まった：Sourcetree / GitHub / VS Code
直前に押したボタン（クリック順）：1)  2)  3)
起きていること：（例）mainで作業した / Pushで認証エラー / PRでConflictsが出た
エラー全文：（画面に出たメッセージをそのまま）
画面の表示：（ブランチ一覧 / File Status / Push画面 / PR画面 など、今見えている文字をそのまま）

すでに確認したこと：（例）認証エラーのチェックリストは全部確認した
※秘密鍵・トークン・パスワードは貼りません
```

※ SSH の秘密鍵・トークン・パスワードは絶対に共有しないでください（公開鍵 `.pub` は共有OKの場面があります）。

### 9-1. 具体例（このまま質問してOK）
- 「`5. プッシュできない（認証エラー）` です。`Permission denied (publickey)` が出ます。チェックリストの “はい/いいえ” を埋めたので、次に確認する場所をクリック順で教えて」
- 「`6. プッシュが拒否された` です。`rejected / non-fast-forward` が出ました。いまのブランチは（___）。Pullしていい？コンフリクトが出たらどの章を見てどう進める？」
- 「`6-1. 初回Pushでupstreamが無い` です。`no upstream branch`（または同等の表示）が出ました。いまのブランチは（___）。SourcetreeのPush画面で、どこにチェックを入れて何を押せばいい？」
- 「`3. mainで作業` してしまった。未コミット/コミット済みの見分け方と、いちばん安全な戻し方を “まず確認→次の操作” の順で教えて」
- 「PRが作れない。GitHubに `feature/...` が見えない。Sourcetreeで確認する順番（ブランチ/Push/Remotes）を短く教えて」
- 「コンフリクトが出た。表示されている内容（エラー文や衝突部分）を書くので、“どっちを残すか” の判断の考え方と、Sourcetree→VS Code→Sourcetree の手順を確認して」

---

## 完了記録

この章には提出課題はありません。
学習が完了したら、スプレッドシートに **完了日** のみ記入してください。
